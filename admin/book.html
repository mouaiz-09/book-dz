<!DOCTYPE html>
<html lang="ar">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Book DZ</title>
  <script src="https://cdn.tailwindcss.com"></script> <!-- Tailwind CDN -->
  <link rel="stylesheet" href="styles.css">
  <!-- #icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


  <!-- arbic fonts-->
  <!--01 *02-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Changa:wght@200..800&family=Vazirmatn:wght@100..900&display=swap"
    rel="stylesheet">
  <!--   font-family: "Vazirmatn", sans-serif;  --> <!--    font-family: "Changa", sans-serif;-->

  <!--04-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Marhey:wght@300..700&display=swap" rel="stylesheet">
  <!--   font-family: "Marhey", sans-serif;-->


  <!--02-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&display=swap" rel="stylesheet">
</head>
<nav>
  <div class="logo">
    <img src="/img/logo-navbar.png" alt="logo" srcset="">
  </div>
</nav>

<body>

  <div class="dz">
    <div class="dashbord">
      <!-- ÙƒØ§Ø±Øª Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ -->
      <div class="boxx">
        <div class="box book">
          <div style="text-align: center; padding: 10px; background-color:  rgb(0, 126, 109);color: whitesmoke; font-size: 30px;
          font-family: 'Marhey', sans-serif; font-weight: 900;
          border-radius: 5px 5px 0 0px; margin-bottom: 10px;">
            <h1>
              Ø§Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø­Ø¯ÙŠØ¯
            </h1>
          </div>
          <form id="addBookForm" style="padding: 10px;">

            <input id="name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨" required>
            <input id="auter" type="text" placeholder="Ø§Ù„Ù…Ø¤Ù„Ù" required>
            <input id="scoor" max="5" type="number" placeholder="Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ù…Ù† 0 Ø¥Ù„Ù‰ 5)" min="0" max="5">
            <input id="cover" type="url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Drive Ø£Ùˆ Ù…Ø¨Ø§Ø´Ø±)">
            <input id="pdf" type="url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù PDF (Drive)">
            <button id="submit-btn" type="submit">â• Ø£Ø¶Ù Ø§Ù„ÙƒØªØ§Ø¨</button>
          </form>
        </div>
      </div>


      <section class="sidemenu">
        <div class="top">
          <h1> ğŸ“Š

            Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©


          </h1>
        </div>
        <div class="bd">
          <ul>
            <li>
              <a href="./dashbord.html" rel="noopener noreferrer">

                ğŸ› ï¸
                Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³Ø©
              </a>
            </li>
            <li>
              <a href="#" rel="noopener noreferrer">

                ğŸ›ï¸
                Ø§ï»¹Ø¯Ø§Ø±Ø©
              </a>
            </li>
            <li style="opacity: 1 !important;">
              <a href="#" rel="noopener noreferrer">
                ğŸ“š
                Ø§Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨
              </a>
            </li>
            <li>
              <a href="hestory.html" rel="noopener noreferrer">

                ğŸ““
                Ø§Ø¶Ø§ÙØ© Ø±ÙˆØ§ÙŠØ§Øª
              </a>
            </li>
            <li style="background-color: rgba(194, 0, 0, 0.815);">
              ğŸ”’
              Ù…ØªÙ‚Ø¯Ù…

            </li>
          </ul>
        </div>
        <div class="bt">
          <a href="../index.html" target="_blank" rel="noopener noreferrer">

            Book-dz
            <i style="margin-left: 7px; " class="fa-solid fa-arrow-up-right-from-square"></i>

          </a>
          <p style="font-weight: 500; color: rgb(128, 125, 125); font-size: 15px; padding: 0;margin: 0;">@2025</p>

      </section>

    </div>

    <script>
      const nameInput = document.getElementById('name');
      const auterInput = document.getElementById('auter');
      const scoorInput = document.getElementById('scoor');
      const coverInput = document.getElementById('cover');
      const pdfInput = document.getElementById('pdf');

      const previewContainer = document.getElementById('preview-container');
      const previewDiv = document.getElementById('cover-preview');
      const infoDiv = document.getElementById('book-info');
      const submitBtn = document.getElementById('submit-btn');

      function getDirectDriveLink(url) {
        const match = url.match(/\/file\/d\/(.*?)(\/|$)/);
        return match ? `https://drive.google.com/uc?export=download&id=${match[1]}` : url;
      }

      function isImageUrl(url) {
        return /(\\.jpg|\\.jpeg|\\.png|\\.gif|\\.webp)$/i.test(url) || url.includes('drive.google.com');
      }

      function updatePreview() {
        const name = nameInput.value.trim();
        const auter = auterInput.value.trim();
        const scoor = scoorInput.value.trim();
        const coverUrl = coverInput.value.trim();
        const pdfUrl = pdfInput.value.trim();

        if (name && auter && scoor && coverUrl && pdfUrl) {
          previewContainer.style.display = 'flex';

          const imageSrc = getDirectDriveLink(coverUrl);
          const pdfLink = getDirectDriveLink(pdfUrl);

          if (isImageUrl(coverUrl)) {
            previewDiv.innerHTML = `<img src="${coverInput.value}" alt="ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù" />`;
          } else {
            previewDiv.innerHTML = `<p style='color:red;'>âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±.</p>`;
          }

          infoDiv.innerHTML = `
          <div class="info-field"><span class="info-label">ğŸ“– Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span> ${name}</div>
          <div class="info-field"><span class="info-label">âœï¸ Ø§Ù„Ù…Ø¤Ù„Ù:</span> ${auter}</div>
          <div class="info-field"><span class="info-label">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span> ${scoor}</div>
          <div class="info-field"><span class="info-label">ğŸ“„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨:</span> <a href="${pdfLink}" target="_blank" style="color:blue;">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨</a></div>
        `;

          submitBtn.style.display = 'block';
        } else {
          previewContainer.style.display = 'none';
          previewDiv.innerHTML = '';
          infoDiv.innerHTML = '';
          submitBtn.style.display = 'none';
        }
      }

      [nameInput, auterInput, scoorInput, coverInput, pdfInput].forEach(input => {
        input.addEventListener('input', updatePreview);
      });

      submitBtn.addEventListener('click', async (e) => {
        e.preventDefault();

        const book = {
          name: nameInput.value,
          auter: auterInput.value,
          scoor: parseFloat(scoorInput.value),
          cover: getDirectDriveLink(coverInput.value),
          link: getDirectDriveLink(pdfInput.value)
        };

        try {
          const res = await fetch('https://book-dz-v1.onrender.com/book', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(book)
          });

          if (res.ok) {
            alert("âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨!");
            previewContainer.style.display = 'none';
            submitBtn.style.display = 'none';
          } else {
            alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
          }
        }

        catch (error) {
          console.log("asa");

        }
      });
    </script>

    <script>
      if (sessionStorage.getItem('modapp') !== 'true') {
        window.location.href = '/admin/';
      }
    </script>
</body>

</html>